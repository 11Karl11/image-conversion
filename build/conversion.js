"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};!function(t,e){"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.imageConversion=e()}(void 0,function(){var t={urltoImage:function(t){return new Promise(function(e,a){var n=new Image;n.onload=function(){return e(n)},n.onerror=function(){return a("urltoImage(): Image failed to load, please check the image URL")},n.src=t})},urltoBlob:function(t){return fetch(t).then(function(t){return t.blob()})},imagetoCanvas:async function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=document.createElement("canvas"),n=a.getContext("2d"),o=void 0,r=void 0;if(e.scale){var i=e.scale>0&&e.scale<10?e.scale:1;r=t.width*i,o=t.height*i}else r=e.width||t.width,o=e.height||t.height;switch([5,6,7,8].some(function(t){return t===e.orientation})?(a.height=r,a.width=o):(a.height=o,a.width=r),e.orientation){case 3:n.rotate(180*Math.PI/180),n.drawImage(t,-a.width,-a.height,a.width,a.height);break;case 6:n.rotate(90*Math.PI/180),n.drawImage(t,0,-a.width,a.height,a.width);break;case 8:n.rotate(270*Math.PI/180),n.drawImage(t,-a.height,0,a.height,a.width);break;case 2:n.translate(a.width,0),n.scale(-1,1),n.drawImage(t,0,0,a.width,a.height);break;case 4:n.translate(a.width,0),n.scale(-1,1),n.rotate(180*Math.PI/180),n.drawImage(t,-a.width,-a.height,a.width,a.height);break;case 5:n.translate(a.width,0),n.scale(-1,1),n.rotate(90*Math.PI/180),n.drawImage(t,0,-a.width,a.height,a.width);break;case 7:n.translate(a.width,0),n.scale(-1,1),n.rotate(270*Math.PI/180),n.drawImage(t,-a.height,0,a.height,a.width);break;default:n.drawImage(t,0,0,a.width,a.height)}return a},canvastoFile:function(t,e){return new Promise(function(a){return t.toBlob(function(t){return a(t)},"image/jpeg",e)})},canvastoDataURL:async function(t,e){return t.toDataURL("image/jpeg",e)},filetoDataURL:function(t){return new Promise(function(e){var a=new FileReader;a.onloadend=function(t){return e(t.target.result)},a.readAsDataURL(t)})},dataURLtoImage:function(t){return new Promise(function(e,a){var n=new Image;n.onload=function(){return e(n)},n.onerror=function(){return a("dataURLtoImage(): dataURL is illegal")},n.src=t})},dataURLtoFile:async function(t,e){for(var a=t.split(","),n=a[0].match(/:(.*?);/)[1],o=atob(a[1]),r=o.length,i=new Uint8Array(r);r--;)i[r]=o.charCodeAt(r);return new Blob([i],{type:e||n})},downloadFile:function(t,e){var a=document.createElement("a");a.href=window.URL.createObjectURL(t),a.download=e||Date.now().toString(36),document.body.appendChild(a);var n=document.createEvent("MouseEvents");n.initEvent("click",!1,!1),a.dispatchEvent(n),document.body.removeChild(a)},compress:async function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e instanceof Blob))throw new Error("compress(): First arg must be a Blob object or a File object.");"number"==typeof a&&(a=Object.assign({quality:a}));var n=await t.filetoDataURL(e),o=n.split(",")[0].match(/:(.*?);/)[1],r=await t.dataURLtoImage(n),i=await t.imagetoCanvas(r,a),c=await t.canvastoDataURL(i,a.quality);return await t.dataURLtoFile(c,o)},compressAccurately:async function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(e instanceof Blob))throw new Error("compressAccurately(): First arg must be a Blob object or a File object.");if("number"==typeof a&&(a=Object.assign({size:a})),1024*a.size>e.size)return e;(!a.accuracy||_typeof(a.accuracy)!==number||a.accuracy<.8||a.accuracy>.99)&&(a.accuracy=.95);for(var n=a.size*(2-a.accuracy)*1024,o=1024*a.size,r=a.size*a.accuracy*1024,i=await t.filetoDataURL(e),c=i.split(",")[0].match(/:(.*?);/)[1],u=await t.dataURLtoImage(i),h=await t.imagetoCanvas(u,a),s=.5,d=void 0,l=[null,null],f=1;f<=7;f++){var m=.75*(d=await t.canvastoDataURL(h,s)).length;if(7===f){(n<m||r>m)&&(d=[d].concat(l).filter(function(t){return t}).sort(function(t,e){return Math.max(.75*e.length-o)-Math.max(.75*t.length-o)})[0]);break}if(n<m)l[1]=d,s-=Math.pow(.5,f+1);else{if(!(r>m))break;l[0]=d,s+=Math.pow(.5,f+1)}}return await t.dataURLtoFile(d,c)}};return t});